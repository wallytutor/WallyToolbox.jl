<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>- · WallyToolbox.jl</title><meta name="title" content="- · WallyToolbox.jl"/><meta property="og:title" content="- · WallyToolbox.jl"/><meta property="twitter:title" content="- · WallyToolbox.jl"/><meta name="description" content="Documentation for WallyToolbox.jl."/><meta property="og:description" content="Documentation for WallyToolbox.jl."/><meta property="twitter:description" content="Documentation for WallyToolbox.jl."/><meta property="og:url" content="https://wallytutor.github.io/WallyToolbox.jl/Computing/OpenFOAM11/aachenBombSteady/"/><meta property="twitter:url" content="https://wallytutor.github.io/WallyToolbox.jl/Computing/OpenFOAM11/aachenBombSteady/"/><link rel="canonical" href="https://wallytutor.github.io/WallyToolbox.jl/Computing/OpenFOAM11/aachenBombSteady/"/><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../search_index.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../../">WallyToolbox.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><span class="tocitem">WallyToolbox</span><ul><li><a class="tocitem" href="../../../">Home</a></li><li><input class="collapse-toggle" id="menuitem-1-2" type="checkbox"/><label class="tocitem" for="menuitem-1-2"><span class="docs-label">Julia Modules</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../Modules/WallyToolbox/">WallyToolbox</a></li><li><a class="tocitem" href="../../../Modules/DryCombustion/">DryCombustion</a></li><li><a class="tocitem" href="../../../Modules/DryFlowsheet/">DryFlowsheet</a></li><li><a class="tocitem" href="../../../Modules/DryGranular/">DryGranular</a></li><li><a class="tocitem" href="../../../Modules/DryMaterials/">DryMaterials</a></li><li><a class="tocitem" href="../../../Modules/DryTransport/">DryTransport</a></li><li><a class="tocitem" href="../../../Modules/RadCalNet/">RadCalNet</a></li><li><a class="tocitem" href="../../../Modules/Cantera/">Cantera</a></li><li><a class="tocitem" href="../../../Modules/OpenFOAM/">OpenFOAM</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-1-3" type="checkbox"/><label class="tocitem" for="menuitem-1-3"><span class="docs-label">Computing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../01-Scientific-Computing/">Scientific Computing</a></li><li><a class="tocitem" href="../../02-General-Computing-Skills/">General computing skills</a></li><li><a class="tocitem" href="../../03-Programming-Languages/">Programming</a></li><li><a class="tocitem" href="../../04-Geometry-and-Preprocessing/">Geometry and Preprocessing</a></li><li><a class="tocitem" href="../../05-Postprocessing/">Postprocessing</a></li><li><a class="tocitem" href="../../06-Domain-Specific-Software/">Domain specific software</a></li><li><a class="tocitem" href="../../Elmer/">Elmer Multiphysics</a></li><li><a class="tocitem" href="../">OpenFOAM 11</a></li><li><a class="tocitem" href="../../Basilisk/">Basilisk</a></li><li><a class="tocitem" href="../../LAMMPS/">LAMMPS</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-1-4" type="checkbox"/><label class="tocitem" for="menuitem-1-4"><span class="docs-label">Science</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../Science/01-Theoretical-Physics/">Theoretical Physics</a></li><li><a class="tocitem" href="../../../Science/02-Density-Functional-Theory/">Density Functional Theory (DFT)</a></li><li><a class="tocitem" href="../../../Science/03-Molecular-Dynamics/">Molecular Dynamics (MD)</a></li><li><a class="tocitem" href="../../../Science/04-Continuum-Mechanics/">Continuum Mechanics</a></li><li><a class="tocitem" href="../../../Science/05-Machine-Learning/">Machine Learning</a></li><li><a class="tocitem" href="../../../Science/07-Finite-Volume-Method/">Finite Volume Method</a></li><li><a class="tocitem" href="../../../Science/08-Conductivity-Porous-Solids/">Thermal conductivity of porous solids</a></li><li><a class="tocitem" href="../../../Science/09-Finite-Element-Method/">Finite Element Method</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-1-5" type="checkbox"/><label class="tocitem" for="menuitem-1-5"><span class="docs-label">Notebooks</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../Notebooks/01-Composite-Conduction/">Steady-state heat transfer</a></li><li><a class="tocitem" href="../../../Notebooks/02-Part-Radiation-Heating/">Transient heat transfer</a></li><li><a class="tocitem" href="../../../Notebooks/03-Plug-Flow-Reactor-1/">Reator pistão</a></li><li><a class="tocitem" href="../../../Notebooks/07-Air-Properties/">Fitting air properties</a></li><li><a class="tocitem" href="../../../Notebooks/08-Kramers-Model-Validation/">Kramers&#39; model</a></li><li><a class="tocitem" href="../../../Notebooks/A1-Julia-para-Cientistas/">Julia para Cientistas</a></li><li><a class="tocitem" href="../../../Notebooks/A2-Ciencia-Colaborativa-e-Julia/">Ciência colaborativa e Julia</a></li></ul></li><li><a class="tocitem" href="../../../References/">References</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>-</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>-</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/wallytutor/WallyToolbox.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/wallytutor/WallyToolbox.jl/blob/main/docs/tmp/Computing/OpenFOAM11/aachenBombSteady.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h2 id="Breakdown-into-sub-models"><a class="docs-heading-anchor" href="#Breakdown-into-sub-models">Breakdown into sub-models</a><a id="Breakdown-into-sub-models-1"></a><a class="docs-heading-anchor-permalink" href="#Breakdown-into-sub-models" title="Permalink"></a></h2><ul><li>[x] Incompressible flow only for mesh and conditions check with <code>incompressibleFluid</code>:</li></ul><pre><code class="nohighlight hljs">- After a first run with a system length of 1 m it was decided to increase the domain to 2 m in order to ensure a better development of flow profile (at least 10 times the cross section size) and double the number of cells in transversal directions.
- It was confirmed that the inlet mean velocity profile respects the expected value from the imposed mass flow rate evaluated during parameters setup, but outlet is controversial. This is probably because the case should be run as turbulent or grid is too coarse.
- Mass conservation was monitored and confirmed through field `phi`.
- It must be emphasized that boundary layer resolution is not accurate since no grading is applied and mesh is very coarse, but since the goal is flare development far from the walls this is acceptable at this stage and will be dealt with at a later stage.
- All residuals are going down adequately, allowing us to move to the next step. 
- Calculation took approximately 10 seconds with 1 core.</code></pre><ul><li>[x] Previous case is copied and support to RAS <span>$k-\varepsilon$</span> <a href="../../../References/@Launder1974/">Launder1974</a> [<a href="../../../References/#Launder1974">53</a>] is implemented:</li></ul><pre><code class="nohighlight hljs">- With inclusion of turbulence the actual outlet velocity matches the expected value (that was unphysical in the previous simulation), validating the approach.
- Entry length is verified through velocity and turbulent viscosity, confirming the need to extend the domain for a proper development.
- The number of iterations was increased to 200 to ensure that everything has properly converged, reaching an extremely low residuals level for all variables.
- Other previous observations are still valid, allowing us to move to the next step.
- Calculation took approximately 11 seconds with 1 core to perform 100 iterations. After 100 iterations the step convergence becomes slow because of the already low residuals, leading to a calculation time of 38 seconds.</code></pre><ul><li>[x] Adding compressible flow with <code>multicomponentFluid</code> to the above:</li></ul><pre><code class="nohighlight hljs">- The temperature field is added prior to handling any combustion aspects in this step to avoid having interaction between these elements in convergence checks. 
- Nonetheless, gravity was already added here after a first run without it for a basic check. A vertical pressure profile is observed in the cross-section, showing the expected buoyancy effects.
- Other Impacted files include physical properties, which now incorporate more detailed thermodynamics, `alphat` and, at least, the main chemical component file with boundary and initial conditions. 
- The mean value of `phi` in the outlet can now be compared to the imposed mass flow rate, validating the boundary condition setup.
- Calculation took approximately 13 seconds with 1 core to perform 100 iterations. Again an important slow down is observed leading to 125 seconds to perform 300 iterations.</code></pre><ul><li>[x] The next logical step is to include evaporation of fuel in the gas, without enabling reactions:</li></ul><pre><code class="nohighlight hljs">- The simples way of doing so is adding the required chemical and associated initial file without adding any combustion or reaction parameters. It was chosen to use the actual species name instead of simply *fuel* to keep created files compatible with next steps. Simulation was checked before adding the cloud, which exponentially complexifies the setup.
- A `patchPostProcessing` cloud function was tested at first to check if conditions were leading to complete fuel evaporation. It is kept commented-out for future debug if required. To make results easier to interpret, a fixed size PSD was adopted at this stage.
- As expected, convergence is bad and the only strategy that seems to work is mesh refinement. Otherwise pressure coupling becomes difficult and trying to change numerical parameters (solver correctors, linear solver, divergence and Laplacian schemes, relaxation level) do not improve anything. Tried to use `SOI` at a later iteration to let flow converge before injection, but apparently the steady solver ignores this. Even with `localEuler` pseudo-time stepping (requires to add residuals for `rho` in `fvSolution`) it does not seem to take `SOI` into account.  Also tried deactivating clouds and converging before reactivating it (what would be equivalent to the later `SOI` approach) and that does not work either, confirming it is a physical coupling problem.
- Because of mesh refinement, now parallelization becomes a requirement unless we work with mesh grading, what is out of the present scope (to be done only in production scenario). Nonetheless, parallelization does not seem to be of great advantage.</code></pre><ul><li>[ ] Activation of global chemistry and combustion modeling:</li></ul><pre><code class="nohighlight hljs">- From now on the level of physics start becoming too complex and pre-computation of fields should be done whenever compatible. That means that prior to chemistry activation it seems a good idea to let evaporation of droplets converge (testing 1000 iterations).
- To keep things general, instead of setting up the case with a fixed database of species thermodynamics, it is better to convert Chemkin files.
-</code></pre><ul><li>[ ] Add radiation modeling</li><li>[ ] Add arbitrary empirical fuel modeling</li></ul><p>After modification the cases were run again getting the following performances, from which it becomes clear that for the present grid size the parallelization saturates quickly.</p><table><tr><th style="text-align: right">Step</th><th style="text-align: right">1 processor</th><th style="text-align: right">32 processors</th></tr><tr><td style="text-align: right">0</td><td style="text-align: right">77</td><td style="text-align: right">14</td></tr><tr><td style="text-align: right">1</td><td style="text-align: right"></td><td style="text-align: right">35</td></tr><tr><td style="text-align: right">2</td><td style="text-align: right"></td><td style="text-align: right">80</td></tr><tr><td style="text-align: right">3</td><td style="text-align: right"></td><td style="text-align: right"></td></tr><tr><td style="text-align: right">4</td><td style="text-align: right"></td><td style="text-align: right"></td></tr></table><h2 id="Future-improvements"><a class="docs-heading-anchor" href="#Future-improvements">Future improvements</a><a id="Future-improvements-1"></a><a class="docs-heading-anchor-permalink" href="#Future-improvements" title="Permalink"></a></h2><ul><li>[ ] Add the following to the parameters file for full turbulence model controls:</li></ul><pre><code class="language-C hljs">Cmu             0.09;
C1              1.44;
C2              1.92;
C3              0;
sigmak          1;
sigmaEps        1.3;</code></pre><ul><li><p>[ ] Add convergence criteria <code>PIMPLE: No convergence criteria found</code>.</p></li><li><p>[ ] Consider a possible adaptive mesh refinement at case setup (not runtime!).</p></li></ul><h2 id="Reminders"><a class="docs-heading-anchor" href="#Reminders">Reminders</a><a id="Reminders-1"></a><a class="docs-heading-anchor-permalink" href="#Reminders" title="Permalink"></a></h2><ul><li>Because of <code>potentialFlow</code> initialization, a dictionary corresponding to this must be present in <code>fvSolution</code> as well as a solver for <code>Phi</code> (copy defaults for pressure). Because this solver does not have information about temperature or composition of fluid, a field <code>rhoInlet</code> is required in inlets.</li></ul><h2 id="Initial-tentative-setup"><a class="docs-heading-anchor" href="#Initial-tentative-setup">Initial tentative setup</a><a id="Initial-tentative-setup-1"></a><a class="docs-heading-anchor-permalink" href="#Initial-tentative-setup" title="Permalink"></a></h2><ul><li><p>This case aims producing a steady state liquid fuel combustion model using <a href="https://github.com/OpenFOAM/OpenFOAM-11/tree/master/tutorials/multicomponentFluid/aachenBomb">aachenBomb</a> case as a starting point, but does not directly tries to reproduce the results of that case. It was modified so that there is an inlet and an outlet for flame development.</p></li><li><p>To perform the setup we retrieve several modifications from <a href="https://github.com/OpenFOAM/OpenFOAM-11/tree/master/tutorials/multicomponentFluid/verticalChannelSteady">verticalChannelSteady</a> and <a href="https://github.com/OpenFOAM/OpenFOAM-11/tree/master/tutorials/multicomponentFluid/verticalChannelLTS">verticalChannelLTS</a>. The first because it is the only case under <code>multicomponentFluid</code> solver currently using a <code>steadyState</code> time-stepping scheme and the latter due to the use of <code>localEuler</code>, which is often used to produce pseudo-steady solutions when a direct steady state calculations becomes unstable (as it is the case in most combustion calculations).</p></li><li><p>Modify <code>controlDict</code> to integer steps (that is, each step is an iteration) for both time-step and write controls, and enable <code>purgeWrite</code> to keep case cleaner. Notice that this is also valid if using a <code>localEuler</code> time-stepping scheme.  Change time-stepping method accordingly in <code>fvSchemes</code>.</p></li><li><p>To increase robustness of solution, it is recommended to compute a potential flow with <code>potentialFoam</code> as in reference case <a href="https://github.com/OpenFOAM/OpenFOAM-11/tree/master/tutorials/multicomponentFluid/verticalChannelLTS">verticalChannelLTS</a>. This requires a solver control field <code>Phi</code> in <code>fvSolution</code> and a  reference <code>rhoInlet</code> value to be provided in inlet flow velocity. Other parameters, but specially <code>maxCo</code> are also copied from reference case.</p></li><li><p>Some dictionaries in <code>cloudProperties</code> require steady-state specific commands, such as adding <code>calcFrequency</code> to <code>solution</code>,  <code>resetOnStartup</code> to <code>solution.sourceTerms</code>, and injection models must use <code>massFlowRate</code>, what is physically understandable.</p></li><li><p>Combustion is quite sensitive and Seulex alone does not seem able to handle it with an <code>EDC</code> approach. First flow was developed further during 100 steps before activating chemistry. For now using a single step <code>infinitelyFastChemistry</code> to try to stabilize the behavior before trying back to use the <code>EDC</code> model.</p></li></ul></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.5.0 on <span class="colophon-date" title="Friday 19 July 2024 05:45">Friday 19 July 2024</span>. Using Julia version 1.10.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
