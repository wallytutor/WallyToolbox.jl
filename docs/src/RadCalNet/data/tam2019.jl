# -*- coding: utf-8 -*-

# XXX draft!

W1 = [
     1.25E+00  -7.04E-01   3.99E-02   2.70E-01   1.02E-02
     1.81E-01   4.66E-01   1.83E-01  -7.31E-02  -2.68E-03
    -2.15E-02  -2.67E+00   5.29E-01  -1.25E-01   1.65E-02
     2.16E-02  -5.42E+00   6.73E-02  -1.13E-02  -9.90E-03
    -2.53E-01  -1.07E-01  -1.11E+01   6.59E-02   4.94E-03
    -3.44E-01   5.38E-01  -4.89E-01   1.96E-01   2.04E-03
     9.81E-02  -2.39E+00  -7.40E-02   1.59E-01  -2.88E-03
    -2.34E-02   8.88E-01   7.58E-01  -2.34E-01  -1.31E-03
    -2.45E+00  -2.13E-02  -2.02E-01  -9.59E-02  -5.35E-03
     2.07E-01   9.06E-01   1.32E-01  -1.74E-01  -1.16E-03
    -1.09E+00   3.16E-01  -8.36E-01  -3.37E-01   4.70E-02
    -1.28E+00   8.49E-02   1.40E+00   1.16E-01  -4.80E-02
     3.06E-01  -1.81E-02   1.79E-01  -6.23E-02   1.56E-03
     2.66E-01  -1.67E-01  -2.41E-01   3.22E-01   1.09E+00
     1.95E-01   1.13E-01  -3.16E+00  -1.39E-01   7.53E-03
     1.16E-01   1.70E-01   1.18E-01  -6.84E-02   1.60E+00
    -1.81E-01  -1.28E-01   1.67E-01  -1.16E+00   3.67E-02
    -3.14E-01   1.39E-01  -2.57E-01  -6.27E-01   4.94E-04
]

W2 = [
       -2.47E-01  -1.07E-01  -5.00E-01  -9.88E-01  -8.15E-01 #=
    =# -9.87E-01   5.96E-01   1.19E+00  -1.54E-01  -5.49E-01 #=
    =#  6.72E-02  -1.51E-02  -2.07E-01   3.31E-02   3.03E-01 #=
    =# -6.46E-02   4.99E-01  -1.46E-01
       -5.71E-01   7.34E-03  -3.64E-01   9.20E-02  -5.86E-03 #=
    =# -4.76E-01   1.02E+00  -5.25E-02  -3.14E-01  -5.77E-01 #=
    =#  4.80E-01   2.10E-01   5.30E-01  -1.39E-01  -7.90E-01 #=
    =#  3.35E-01   5.91E-01  -4.32E-01
       -4.29E-01   6.78E-01   1.79E-01  -1.40E-01  -8.92E-01 #=
    =#  8.35E-01   3.75E-01   6.65E-01  -2.79E-01  -5.97E-01 #=
    =#  1.98E-01   1.73E-01  -4.37E-01   2.70E-01   1.32E+00 #=
    =# -7.27E-01  -3.47E-01   6.01E-01
       -4.36E-01  -1.02E-02  -5.16E-02  -2.90E-01  -2.34E-01 #=
    =#  4.82E-01  -3.97E-01  -9.59E-01  -2.67E-01  -2.14E-02 #=
    =#  8.60E-01   6.96E-01  -4.69E-02   3.59E-01  -8.68E-01 #=
    =# -3.75E-01  -1.91E-02  -1.32E-01
        4.43E-03  -1.70E+00  -2.90E-01  -1.19E-01   2.41E-01 #=
    =# -4.70E-01  -1.79E-01   9.58E-02  -7.47E-02  -7.71E-01 #=
    =#  2.29E-02  -1.34E-01   1.39E+00  -4.29E-02  -5.56E-02 #=
    =#  5.33E-02   1.66E-01   6.64E-03
       -2.52E-02  -4.20E-01  -7.06E-02  -6.64E-02  -2.14E+00 #=
    =#  7.91E-03   8.62E-03   7.60E-02  -4.64E-02  -2.81E-01 #=
    =#  2.73E-02  -9.49E-03  -2.38E+00   7.00E-03   5.85E-01 #=
    =# -6.93E-02   5.47E-02  -9.52E-01
       -4.37E-02  -6.28E-01   1.67E-01   3.67E-01   1.84E-01 #=
    =#  6.96E-01  -3.02E-01  -6.31E-01   8.93E-02   2.50E-01 #=
    =#  1.02E-01  -1.13E-01  -1.08E+00  -2.19E-01   9.63E-02 #=
    =#  3.65E-01  -7.85E-01   9.68E-01
        1.63E-01  -7.49E-01  -5.72E-02   2.97E-01  -1.70E-01 #=
    =#  5.15E-01  -3.04E-01   1.86E-01  -3.29E-01   1.07E+00 #=
    =# -5.58E-01  -9.24E-01  -4.58E-01   1.54E-01   7.88E-01 #=
    =#  1.19E-01   5.02E-01  -1.26E-01
       -2.68E-01   5.80E-01  -2.53E-01  -3.97E-01  -1.49E+00 #=
    =# -2.80E-01   1.85E-01   2.25E-01  -2.08E-01  -1.24E+00 #=
    =#  1.99E-01  -8.15E-02   4.09E-01  -1.28E-01   3.43E-01 #=
    =#  1.84E-01   2.12E-01   4.09E-02
       -3.69E-02   1.13E+00  -2.74E-02   4.50E-02   5.01E+00 #=
    =# -2.33E-01  -6.90E-02  -2.69E-02  -3.71E-03  -2.62E-02 #=
    =#  1.55E-02  -3.66E-02   7.76E-01   2.90E-02  -1.13E+00 #=
    =#  1.72E-02  -5.92E-02  -1.12E+00
]

W3 = [
    -1.27E+00
    -2.07E-01
    -6.04E-01
    -6.49E-02
    -2.44E+00
     6.53E+00
    -1.18E+00
    -3.52E-03
     1.03E+00
     2.75E+00
]'

b1 = [
    -3.02E+00
     1.45E+00
     1.29E+00
    -3.45E+00
    -1.25E+01
    -6.33E-01
    -1.11E+00
    -3.22E-01
     4.70E-01
     1.18E-01
    -1.42E-01
    -4.98E-01
     1.73E+00
     2.46E+00
     3.80E+00
     2.83E+00
    -1.79E+00
    -2.79E+00
]

b2 = [
     1.37E+00
     1.53E+00
    -1.02E+00
     3.00E-01
     6.46E-01
    -9.84E-01
     2.18E-01
    -1.03E+00
    -1.62E+00
     2.99E+00
]

b3 = [1.12E-01]

Tw = 1500.0
Tg = 1000.0

pg = 27.0

x_h2o = 0.18
x_co2 = 0.09

p_tot = 101.0
p_h2o = x_h2o * p_tot
p_co2 = x_co2 * p_tot

fv = 0.0

L = pg / (p_h2o + p_co2)
a_co2 = p_co2 / (p_h2o + p_co2)
fvl = fv * L

X = zeros(14)
X[1] = x_co2
X[2] = x_h2o
X[end] = 1.0 - sum(X[1:2])

P = [Tw Tg pg a_co2 fvl]
P_min = [3.0e+02 3.0e+02 0.0e+00 0.0 0.0e-06]
P_max = [2.0e+03 2.0e+03 2.0e+03 1.0 1.0e-06]

# Reading the code it seems this is what they mean by normalization.
p = @. (P - P_min) / (P_max - P_min)
p = @. 2.0 * p - 1.0

l0 = transpose(p)
l1 = tanh.(W1 * l0 + b1)
l2 = tanh.(W2 * l1 + b2)
l3 =       W3 * l2 + b3

# Also for model results there is some weird transformation.
tams = 0.5 * (l3 .+ 1.0)

radcal = rd.runradcalinput(;
    X = X,
    T = Tg,
    L = L,
    P = p_tot / 101.0,
    FV = fv,
    TWALL = Tw
)

tams[1], radcal[24]